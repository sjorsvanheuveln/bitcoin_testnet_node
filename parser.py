#!/usr/bin/env python3

'''
Bitcoin Blockchain Parser
Parse the blockchain and save the data to a database and perform analysis.
SvH 18-11-2021
'''

####################################
from database import *


'''fill db'''
#blocks = get_block(100000, parse_tx_flag = False)
db = Database('blocks')
#db.drop()
#db.add_multiple(blocks)
#db.update_block_heights()

plot(db.sort(), 'difficulty')



''' TODO
1. Try to retrieve transactions from DB
2. Fix parsing error. Why is this occurring? prev_block: 00000000000002da8695671b6c6217e0484a0e39eb534f89d281ca69ee5ac75d
    Block: 142312
    https://mempool.space/nl/tx/50cfd3361f7162b3c0c00dacd3d0e4ddf61e8ec0c51bfa54c4ca0e61876810a9
3. Make a function that will correctly update the database to the latest block on my node.
'''

# block142312 = BytesIO(bytes.fromhex('01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff41fc70035c7a81bc6f4876c6036e4bc4080eaf81377bc9672828061491e79df5d4ddf1d65b058ccb30563f1f1c14f658607bd2c7138e87e480bcec3f5b91d041d041ffffffff1173f6e61100000000434104fbcaecde4b9ef952cdedc4d8de13a57c1571c546f281d66a2888cfcae49e7d7bdf9d53856b523e18604daf99f20d421810b1be2a13e5e0dc66c04d9e65a65dadac48787d0100000000434104ffd03de44a6e11b9917f3a29f9443283d9871c9d743ef30d5eddcd37094b64d1b3d8090496b53256786bf5c82932ec23c3b74d9f05a6f95a8b5529352656664bac578c29c6000000001976a91438a81ace130f1899a9f782eb7e4773214f2a200d88ac226e9105000000001976a91452c5ea82a56a1b0ea3c728f8b1b1c9b7858e455688ac471a0d00000000001976a91454a70c3cf312ab8e2f9793448b920e41c03c95b788acd76b3800000000001976a9145a1a43e18bb3e624b0cb72ef773616850b5c646088aca2f20a00000000001976a9147ef2ef14e787c2145d6e631137980343ffc7538188ace6b50700000000001976a91483ef9395c4b6829e0609e7dfd5c5eb2c6fd6e4fc88acaf22bb08000000001976a9148d96361ba71598a993b909c5e0e80d752a5d565e88acf49e3b11000000001976a91494605280450f39bfb12be48d3b331490ff83b0e488ac8bd00a00000000001976a914951600543556f89a34f79de0ea75e447c585c08e88ac72630700000000001976a914ae449cb6b7ee14c2d60d2b4d09fe88db054bc85088ac83ea9102000000001976a914b1ba6f1e44d17006549c754ab61bc0d1fa65bfbe88ac95745f00000000001976a914dc94bc48a2fba690948713add3132dafad4d097b88ac2f418613000000001976a914e6cb8e55b58a274637581be44746059494b253ec88acbb997802000000001976a914f14ec835492ccccdf719092bef9153a77d843e8d88ac842a9517000000001976a9144c974fa629466c2a01b75c82e69968e1625521d988ac00000000'))
# Tx.parse(block142312)